var all_subs = ['composer', 'baroque', 'classicalmusic', 'contemporary', 'concertband', 'choralmusic', 'ChamberMusic', 'EarlyMusic', 'earlymusicalnotation', 'ElitistClassical', 'icm', 'Opera', 'orchestra', 'acidhouse', 'ambientmusic', 'AStateOfTrance', 'AtmosphericDnB', 'BigBeat', 'boogiemusic', 'breakbeat', 'breakcore', 'chicagohouse', 'chillout', 'Chipbreak', 'Chiptunes', 'complextro', 'cxd', 'darkstep', 'deephouse', 'DnB', 'DubStep', 'EDM', 'EBM', 'electronicdancemusic', 'ElectronicJazz', 'ElectronicBlues', 'electrohiphop', 'electrohouse', 'electronicmagic', 'ElectronicMusic', 'electropop', 'electroswing', 'ExperimentalMusic', 'fidget', 'filth', 'frenchelectro', 'frenchhouse', 'funkhouse', 'fusiondancemusic', 'futurebeats', 'FutureFunkAirlines', 'FutureGarage', 'futuresynth', 'gabber', 'glitch', 'glitchop', 'Grime', 'happyhardcore', 'hardhouse', 'hardstyle', 'house', 'idm', 'industrialmusic', 'ItaloDisco', 'latinhouse', 'LiquidDubstep', 'mashups', 'melodichouse', 'minimal', 'mixes', 'moombahcore', 'nightstep', 'OldskoolRave', 'Outrun', 'theOverload', 'partymusic', 'plunderphonics', 'psybient', 'PsyBreaks', 'psytrance', 'purplemusic', 'raggajungle', 'RealDubstep', 'skweee', 'swinghouse', 'tech_house', 'Techno', 'Trance', 'tranceandbass', 'trap', 'tribalbeats', 'TropicalHouse', 'ukfunky', 'witchhouse', 'wuuB', '80sHardcorePunk', '90sAlternative', '90sPunk', '90sRock', 'AlternativeRock', 'AltCountry', 'AORMelodic', 'ausmetal', 'BlackMetal', 'bluegrass', 'Blues', 'bluesrock', 'Boneyard', 'CanadianClassicRock', 'CanadianMusic', 'ClassicRock', 'country', 'Christcore', 'crunkcore', 'deathcore', 'deathmetal', 'Djent', 'DoomMetal', 'Drone', 'Emo', 'EmoScreamo', 'epicmetal', 'flocked', 'folk', 'folkmetal', 'folkpunk', 'folkrock', 'folkunknown', 'GaragePunk', 'GothicMetal', 'Grunge', 'hardcore', 'HardRock', 'horrorpunk', 'indie_rock', 'jrock', 'krautrock', 'LadiesofMetal', 'MathRock', 'melodicdeathmetal', 'MelodicMetal', 'MetalNews', 'Metalmusic', 'metal', 'metalcore', 'ModernRockMusic', 'monsterfuzz', 'neopsychedelia', 'NewWave', 'noiserock', 'numetal', 'pianorock', 'poppunkers', 'PostHardcore', 'PostRock', 'powermetal', 'powerpop', 'ProgMetal', 'progrockmusic', 'PsychedelicRock', 'punk', 'Punkskahardcore', 'Punk_Rock', 'raprock', 'Rock', 'shoegaze', 'stonerrock', 'symphonicblackmetal', 'symphonicmetal', 'synthrock', 'ThrowbackCore', 'truethrash', 'Truemetal', 'OutlawCountry', 'WomenRock', '80sHipHop', '90sHipHop', 'altrap', 'asianrap', 'backpacker', 'backspin', 'BayRap', 'ChapHop', 'ChiefKeef', 'DrillandBop', 'Emo_Trap', 'Gfunk', 'hiphopheads', 'hiphopheadsnorthwest', 'hiphop101', 'MemphisRap', 'NYrap', 'Rap', 'raprock', 'rapverses', 'rhymesandbeats', 'trapmuzik', 'ukhiphopheads', 'undergroundchicago', 'LofiHipHop', '2010smusic', '2000smusic', '90sMusic', '80sremixes', '80sMusic', '70sMusic', '60sMusic', '50sMusic', 'AfricanMusic', 'afrobeat', 'balkanbrass', 'balkanmusic', 'brazilianmusic', 'britpop', 'CroatianMusic', 'Flamenco', 'Irishmusic', 'ItalianMusic', 'jpop', 'KoreanRock', 'kpop', 'RoMusic', 'spop', 'somluso', 'UKbands', 'WorldMusic', '70s', 'Acappella', 'AcousticCovers', 'ambientfolk', 'animemusic', 'BestOfDisney', 'boomswing', 'bossanova', 'carmusic', 'concerts', 'chillmusic', 'cpop', 'Complextro', 'dembow', 'disco', 'DreamPop', 'dub', 'Elephant6', 'ETIMusic', 'Exotica', 'FilmMusic', 'FunkSouMusic', 'gamemusic', 'GamesMusicMixMash', 'GunslingerMusic', 'GypsyJazz', 'IndieFolk', 'jambands', 'jazz', 'JazzFusion', 'JazzInfluence', 'listentoconcerts', 'klezmer', 'lt10k', 'MedievalMusic', 'MelancholyMusic', 'minimalism_music', 'motown', 'MusicForConcentration', 'muzyka', 'NuDisco', 'oldiemusic', 'OldiesMusic', 'pianocovers', 'popheads', 'PoptoRock', 'QuietStorm', 'rainymood', 'recordstorefinds', 'reggae', 'remixxd', 'RetroMusic', 'rnb', 'rootsmusic', 'SalsaMusic', 'Ska', 'Soca', 'songbooks', 'Soulies', 'SoulDivas', 'SoundsVintage', 'SpaceMusic', 'SurfPunk', 'swing', 'Tango', 'TheRealBookVideos', 'TouhouMusic', 'TraditionalMusic', 'treemusic', 'triphop', 'vaporwave', 'VintageObscura', 'vocaloid', 'audioinsurrection', 'albumaday', 'albumoftheday', 'Albums', 'albumlisteners', 'bassheavy', 'BinauralMusic', 'BoyBands', 'Catchysongs', 'Chopping', 'CircleMusic', 'CoverSongs', 'cyberpunk_music', 'DANCEPARTY', 'danktunes', 'deepcuts', 'EarlyMusic', 'earlymusicalnotation', 'FemaleVocalists', 'festivals', 'findaband', 'FitTunes', 'FreeAlbums', 'freemusic', 'Frisson', 'gameofbands', 'GayMusic', 'germusic', 'gethightothis', 'GuiltyPleasureMusic', 'HeadNodders', 'heady', 'HeyThatWasIn', 'HighFidelity', 'ifyoulikeblank', 'ilikethissong', 'indie', 'IndieWok', 'Indieheads', 'Instrumentals', 'ipm', 'IsolatedVocals', 'LeeHallMusic', 'LetsTalkMusic', 'listentoconcerts', 'listentodynamic', 'listentomusic', 'listentonews', 'ListenToThis', 'ListenToUs', 'livemusic', 'llawenyddhebddiwedd', 'LongerJams', 'Lyrics', 'mainstreammusic', 'makemeaplaylist', 'MiddleEasternMusic', 'MLPtunes', 'Music', 'MusicAlbums', 'musicanova', 'musicsuggestions', 'MusicToSleepTo', 'musicvideos', 'NameThatSong', 'NewAlbums', 'newmusic', 'onealbumaweek', 'partymusic', 'RedditOriginals', 'RepublicOfMusic', 'RoyaltyFreeMusic', 'runningmusic', 'ScottishMusic', 'SlavicMusicVideos', 'songwriterscircle', 'SpotifyMusic', 'ThemVoices', 'TodaysFavoriteSong', 'unheardof', 'WhatIListenTo', 'WTFMusicVideos', 'AlbumArtPorn', 'albumreviews', 'Audio', 'Audiophile', 'audiophilemusic', 'AustinMusicians', 'bandmembers', 'CarAV', 'CassetteCulture', 'Cd_collectors', 'ConcertTickets', 'germusic', 'glastonbury_festival', 'ICoveredASong', 'ifyoulikeblank', 'independentmusic', 'ineedasong/', 'japanesemusic', 'Jazzguitar', 'koreanmusic', 'LubbockMusicians', 'mixcd', 'musiccritics', 'MusicalComedy', 'musicessentials', 'MusicEventMeetUp', 'musicfestivals', 'musicnews', 'MusiciansBlogs', 'Musicians', 'MusicProduction', 'NeedVocals', 'OSOM', 'performer', 'RecordClub', 'recordstore', 'redditmusicclub', 'Rockband', 'RockbandChallenges', 'TheSongRemainsTheSame', 'TipOfMyTongue', 'TouringMusicians', 'vinyl', 'VinylReleases', 'WeAreTheMusicMakers', '300Songs', 'AcousticOriginals', 'BedroomBands', 'Composer', 'ICoveredASong', 'independentmusic', 'MusicCritique', 'MusicInTheMaking', 'MyMusic', 'RadioReddit', 'RoastMyTrack', 'ratemyband', 'Songwriters', 'TheseAreOurAlbums', 'ThisIsOurMusic', 'UserProduced', 'WereOnSpotify', 'WhiteLabels', '311', 'ADTR', 'AliciaKeys', 'ArcadeFire', 'ArethaFranklin', 'APerfectCircle', 'AvengedSevenfold', 'TheAvettBrothers', 'BABYMETAL', 'Bangtan', 'BaysideIsACult', 'TheBeachBoys', 'Beatles', 'billytalent', 'Blink182', 'BMSR', 'BoBurnham', 'boniver', 'brandnew', 'BruceSpringsteen', 'Burial', 'ChanceTheRapper', 'cher', 'ChiefKeef', 'ChristinaAguilera', 'cityandcolour', 'Coldplay', 'CutCopy', 'TheCure', 'DaftPunk', 'DavidBowie', 'Deadmau5', 'DeathCabforCutie', 'DeathGrips', 'DeepPurple', 'Deftones', 'DieAntwoord', 'DMB', 'donaldglover', 'Drizzy', 'elliegoulding', 'Eminem', 'empireofthesun', 'EnterShikari', 'Evanescence', 'FallOutBoy', 'feedme', 'FirstAidKit', 'flaminglips', 'fleet_foxes', 'Foreigner', 'FrankOcean', 'franzferdinand', 'finkworld', 'Ghostbc', 'Gorillaz', 'grateful_dead', 'Greenday', 'GunsNRoses', 'Incubus', 'JackJohnson', 'JackWhite', 'JanetJackson', 'JackJohnson', 'Kanye', 'KendrickLamar', 'kings_of_leon', 'Korn', 'ladygaga', 'lanadelrey', 'lennykravitz', 'Led_Zeppelin', 'lorde', 'macdemarco', 'Macklemore', 'Madonna', 'Madlib', 'Manowar', 'MariahCarey', 'MattAndKim', 'Megadeth', 'Metallica', 'mfdoom', 'MGMT', 'MichaelJackson', 'MinusTheBear', 'ModestMouse', 'Morrissey', 'mrbungle', 'MyChemicalRomance', 'Muse', 'NeilYoung', 'NIN', 'Nirvana', 'NOFX', 'oasis', 'officialbadcompany', 'ofMontreal', 'OfMonstersAndMen', 'OFWGKTA', 'Opeth', 'OutKast', 'panicatthedisco', 'PearlJam', 'phish', 'Pinback', 'PinkFloyd', 'ThePolice', 'porcupinetree', 'prettylights', 'Puscifer', 'Queen', 'Radiohead', 'RATM', 'RedHotChiliPeppers', 'RelientK', 'rhymesandbeats', 'RiseAgainst', 'robertplant', 'SaveMoneyCrew', 'SigurRos', 'Slayer', 'slipknot', 'SmashingPumpkins', 'SOCOTRAband', 'SparksFTW', 'TameImpala', 'TaylorSwift', 'TeganAndSara', 'TheKillers', 'TheMagneticZeros', 'TheOffspring', 'thepixies', 'The_Residents', 'TheStrokes', 'TheWeeknd', 'tmbg', 'ToolBand', 'tragicallyhip', 'trunknation', 'TwentyOnePilots', 'U2Band', 'Umphreys', 'UnicornsMusic', 'velvetunderground', 'Ween', 'weezer', 'WeirdAl', 'yesband', 'Zappa', 'AlbumArtPorn', 'BandPorn', 'concertporn', 'guitarPorn', 'HipHopImages', 'InstrumentPorn', 'MetalMemes', 'MusicBattlestations', 'MusicPics', 'DJs', 'PirateRadio', 'Spotify', 'Turntablists', 'abletonclass', 'bandmembers', 'basslessons', 'earlymusicalnotation', 'Ethnomusicology', 'ExplainThisSong', 'GuitarLessons', 'LearnMusic', 'MusicEd', 'musicindustry', 'MusicInstructor', 'musicology', 'MusicTheory', 'solresol', 'tabs', 'Accordion', 'banjo', 'Bass', 'bassplaying', 'Bassoon', 'beatbox', 'brass', 'Cello', 'Clarinet', 'ClassicalGuitar', 'Concertina', 'DoubleBass', 'Drummers', 'Drums', 'Flute', 'Guitar', 'GuitarPlaying', 'hammondorgan', 'handpan', 'harmonica', 'Horn', 'keys', 'luthier', 'Mandolin', 'Oboe', 'Ocarina', 'Percussion', 'Percussionists', 'Piano', 'Piccolo', 'PlayingGuitar', 'Recorder', 'saxophone', 'saxophonics', 'Singing', 'synthesizers', 'Telecaster', 'Trombone', 'Trumpet', 'tuba', 'ukulele', 'viola', 'Violinist', 'AudioEngineering', 'EDMproduction', 'FL_Studio', 'ableton', 'AbletonLive', 'AudioPost', 'Cubase', 'futurebeatproducers', 'GameAudio', 'linuxaudio', 'LocationSound', 'Logic_Studio', 'makinghiphop', 'MaxMSP', 'ProductionLounge', 'Protools', 'RateMyAudio', 'Reaper', 'Reasoners', 'Remix', 'Renoise', 'Samplehunters', 'SongStems', 'VSTi:', 'DIYGear', 'diyguitar', 'Gear4Sale', 'GuitarPedals', 'skullcandy', 'Synthesizers'];
my_insert = "e22ca836a309" // don't delete this

//initialize firebase
var firebaseConfig = {
  apiKey: "AIzaSyA9siLziz2yFElLNJ3d_1_6nNs42IW_jAs",
  authDomain: "minty-tracks.firebaseapp.com",
  databaseURL: "https://minty-tracks.firebaseio.com",
  projectId: "minty-tracks",
  storageBucket: "minty-tracks.appspot.com",
  messagingSenderId: "625017438260",
  appId: "1:625017438260:web:193c815376abc62b"
};

firebase.initializeApp(firebaseConfig);
var database = firebase.database();

//onclick for btnAdd button to push user subreddits into checkboxes
$("#btnAdd").on("click", function () {
  var musicSub = $("#newSub").val().trim();
  var timeframe = $("#timeframe").val();

  if (!musicSub) {

  }
  else {

    $("#newSub").val("")
    var newSub = {
      "musicSub": musicSub,
      "timeframe": timeframe
    };

    database.ref().push(newSub);
  };
});

//database function to populate .checkboxSub
database.ref().on("child_added", function (childSnapshot) {
  var musicSub = childSnapshot.val().musicSub;
  var timeframe = childSnapshot.val().timeframe;

  $("#checkboxSub").prepend('<p>' +
    '<label>' +
    '<input type="checkbox" class="musicSub" musicSub=' + musicSub + ' timeframe=' + timeframe + ' id="' + musicSub + "_" + timeframe + '" />' +
    '<span>' + musicSub + "  in the last " + timeframe + '</span>' +
    '</label>' +
    '</p>')
});

//onclick for search button
$("#search").on("click", function () {
  // FOR each entry in #checkboxSub
  var list_of_subs = [];
  $(".musicSub").each(function (i) {
    console.log(i);
    if ($(this).prop('checked') == true);
    {
      var ms = $(this).attr('musicSub').val();
      var tf = $(this).attr('timeframe').val();
    }
    list_of_subs.push((ms, tf));
  });

  response = reddit_call(list_of_subs);
  console.log(response);


  // ORDER MUST BE PRESERVED
  // INVOKE matts function for calling Reddit API
  // INVOKE Nicks function using matts Reddit response - STORE RESULTS
  // INVOKE the GET_BPM fxn
  // COMBINE ELEMENTS INTO MAIN WEBSITE

  // PUT his reponse to use

  // Call NICKS function with new data

});

//interactive element functionality
$(document).ready(function () {
  $('select').formSelect();
});

$(document).ready(function () {
  $('.sidenav').sidenav();
});



var reddit_call = function (sub, time) {
  /*
  DESCRIPTION:
    Convert subreddit + timeframe to a list of useable youtube video IDs

  INPUTS:
          EXAMPLES:
              "50sMusic","all"   <<<<<========== PASS IN SOMETHING LIKE THIS IN
              "guitar","month"
              "dubstep","week"                   GET SOMETHING LIKE THIS BACK
                                               ||
  RESPONSE:                                    ||
          EXAMPLE:                             ||
          {                                    \/
              zBzZJd-nfw: {title: "Marty Robbins - El Paso (1959)", url: "https://www.youtube.com/watch?v=-zBzZJd-nfw&amp;index=12&amp;list=PLoFQzfvcvGcVHBAv0PkN17iLA_n0aQNme"}
              FyM8NVl4yBY: {title: "The Platters - The Great Pretender (1955)", url: "https://www.youtube.com/watch?v=FyM8NVl4yBY&amp;app=desktop&amp;persist_app=1"}
              PwXai-sgM-s: {title: "Screamin' Jay Hawkins - I Put A Spell On You", url: "https://www.youtube.com/watch?v=PwXai-sgM-s"}
              SDtVAM80zbg: {title: "The Chordettes - Mr. Sandman", url: "https://www.youtube.com/watch?v=SDtVAM80zbg"}
              VJcGi4-n_Yw: {title: "Earth Angel - The Penguins 1955 ", url: "http://www.youtube.com/watch?v=VJcGi4-n_Yw"}
              kLBWkM0jzK0: {title: "Buddy Holly - Everyday", url: "http://www.youtube.com/watch?v=kLBWkM0jzK0"}
              m8OlDPqYBLw: {title: "Bobby Darin - Beyond The Sea (1959)", url: "https://www.youtube.com/watch?v=m8OlDPqYBLw"}
              oNuX7bs2qAM: {title: "The Chordettes - Mr. Sandman", url: "http://www.youtube.com/watch?v=oNuX7bs2qAM"}
              pFABN2EydC8: {title: "Come Go With Me - The Del-Vikings", url: "https://youtu.be/pFABN2EydC8"}
          }
  */

  var all_jams = {};

  reddit.top(sub).t(time).limit(500).fetch(function (res) {
    kids = res.data.children;
    for (var i = 0; i < kids.length && i < 10; i++) {
      if (validateYouTubeUrl(kids[i].data.url)) {
        var key = validateYouTubeUrl(kids[i].data.url);
        var new_item = {
          'title': kids[i].data.title,
          'url': kids[i].data.url
        }
        all_jams[key] = new_item;

      };
    }
  });
  return all_jams;
}

// SEPARATE FXN FOR VALIDATIONG YOUTUBE LINKS
function validateYouTubeUrl(url) {
  if (url != undefined || url != '') {
    var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|\?v=)([^#\&\?]*).*/;
    var match = url.match(regExp);
    if (match && match[2].length == 11) {
      return (match[2]);
    }
  }
  return (false);
}


function find_artist_title(search_terms) {
  /*
  INPUT: STRING
         EXAMPLE: "Marty Robbins - El Paso (1959)"

  RESPONSE: OBJECT
            EXAMPLE: {artist: "Marty Robbins", name: "El Paso (1959)"}
  */
  try{
    var chunk = "i_k"; // This is meant to foil someone trying to steal my key
    var my_search = "http://ws.audioscrobbler.com/2.0/?method=track.search&track=" + search_terms + "&ap" + chunk + "ey=e17316" + my_insert + "1938a2303a8f6e&format=json";
    var msg = $.ajax({ type: "GET", url: my_search, async: false }).responseText;
    var msg_json = JSON.parse(msg);
    var artist = msg_json.results.trackmatches.track[0].artist
    var song_name = msg_json.results.trackmatches.track[0].name
    return { "artist": artist, "song_name": song_name }
  }
    catch(error) {
      console.error(error);
      // expected output: ReferenceError: nonExistentFunction is not defined
      // Note - error messages will vary depending on browser
      return { "artist": '', "song_name": '' }
    }

}



// UNIT TEST
// VideoIDs = reddit_call("50sMusic", "all");
// console.log(VideoIDs);

// UNIT TEST
response = find_artist_title("Marty Robbins - El Paso (1959)");
console.log(response);